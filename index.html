<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>1‚Çøillion Coin Transfer</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: auto; padding: 20px; }
    input, button { padding: 10px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    .row { display: flex; flex-wrap: wrap; gap: 20px; }
    .col { flex: 1; min-width: 300px; }
    iframe { margin-top: 30px; width: 100%; height: 400px; border: none; }
    #reader { width: 100%; }
  </style>
</head>
<body>

  <h1>üí∞ ‡πÇ‡∏≠‡∏ô 1‚Çøillion Coin (Bitkub Chain)</h1>

  <div class="row">
    <div class="col">
      <button onclick="connectMetamask()">üîå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Metamask</button>
      <button onclick="connectBitkubNext()">üîå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Bitkub Next</button>
      <p id="walletAddress">‚õî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤</p>
      <p id="tokenPrice">üìà ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î...</p>

      <input type="text" id="recipient" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (0x...)">
      <input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô">
      <button onclick="sendToken()">üì§ ‡πÇ‡∏≠‡∏ô Token</button>
      <p id="status"></p>
    </div>

    <div class="col">
      <h3>üì• QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô</h3>
      <div id="qrcode"></div>
      <br><button onclick="startScan()">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</button>
      <div id="reader" style="display: none;"></div>
    </div>
  </div>

  <h2>üìâ ‡∏Å‡∏£‡∏≤‡∏ü‡∏£‡∏≤‡∏Ñ‡∏≤ 1‚Çøillion Coin</h2>
  <iframe
    src="https://www.geckoterminal.com/bitkub_chain/pools/0xf42d65b190bb78fb8ead8a92110b653722f96048?embed=1&info=0&swaps=0&grayscale=0&light_chart=0&chart_type=price&resolution=1month">
  </iframe>

  <script>
    const tokenAddress = "0x4dc6f1fa9fd93f28d9b3b37592c572ba18bf6f10";
    const tokenABI = [
      "function transfer(address to, uint256 amount) public returns (bool)",
      "function decimals() view returns (uint8)"
    ];
    const DECIMALS = 8;
    const CHAIN_ID = "0x60"; // 96 (hex) = Bitkub Chain

    let signer;

    async function connectWallet() {
      if (!window.ethereum) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö Metamask ‡∏´‡∏£‡∏∑‡∏≠ Bitkub Next");

      try {
        await window.ethereum.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: CHAIN_ID }]
        });

        const provider = new ethers.providers.Web3Provider(window.ethereum, "any");
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById("walletAddress").innerText = "‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß: " + address;

        QRCode.toCanvas(document.getElementById("qrcode"), address, function (error) {
          if (error) console.error(error);
        });

        fetchPrice();
      } catch (err) {
        alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + err.message);
      }
    }

    function connectMetamask() {
      connectWallet();
    }

    function connectBitkubNext() {
      connectWallet();
    }

    async function sendToken() {
      const to = document.getElementById("recipient").value.trim();
      const amount = document.getElementById("amount").value.trim();
      if (!signer || !to || !amount) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

      try {
        const contract = new ethers.Contract(tokenAddress, tokenABI, signer);
        const amountParsed = ethers.utils.parseUnits(amount, DECIMALS);
        const tx = await contract.transfer(to, amountParsed);
        document.getElementById("status").innerText = "‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°...";
        await tx.wait();
        document.getElementById("status").innerHTML = `‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: <a href="https://www.kubscan.com/tx/${tx.hash}" target="_blank">${tx.hash}</a>`;
      } catch (err) {
        document.getElementById("status").innerText = "‚ùå ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " + err.message;
      }
    }

    function startScan() {
      const readerDiv = document.getElementById("reader");
      readerDiv.style.display = "block";
      const html5QrCode = new Html5Qrcode("reader");

      html5QrCode.start(
        { facingMode: "environment" },
        {
          fps: 10,
          qrbox: 250
        },
        (decodedText) => {
          document.getElementById("recipient").value = decodedText;
          html5QrCode.stop();
          readerDiv.style.display = "none";
        },
        (error) => {}
      ).catch((err) => {
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: " + err);
      });
    }

    async function fetchPrice() {
      try {
        const res = await fetch("https://api.geckoterminal.com/api/v2/networks/bitkub_chain/pools/0xf42d65b190bb78fb8ead8a92110b653722f96048");
        const json = await res.json();
        const price = parseFloat(json.data.attributes.base_token_price_usd).toFixed(6);
        document.getElementById("tokenPrice").innerText = `üìà ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: $${price} USD`;
      } catch (err) {
        document.getElementById("tokenPrice").innerText = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏î‡πâ";
      }
    }

    setInterval(fetchPrice, 30000);
  </script>
</body>
</html>
